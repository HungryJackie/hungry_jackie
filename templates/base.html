<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{% block title %}Hungry Jackie{% endblock %}</title>
  {% load static %}
  <style>
    /* CSS 변수 정의 - 전역 일관성 보장 */
    :root {
      --navbar-bg: #ffffff;
      --navbar-border: #e5e7eb;
      --navbar-text: #111827;
      --navbar-text-muted: #6b7280;
      --navbar-text-active: #374151;
      --navbar-hover-bg: #f3f4f6;
      --navbar-primary: #6366f1;
      --navbar-primary-hover: #4f46e5;
      --navbar-danger: #ef4444;
      --navbar-danger-hover: #dc2626;
      --navbar-height: 72px;
    }

    /* 링크 밑줄 전역 제거 */
    a, a:visited { text-decoration: none !important; }
    a:hover, a:focus, a:active { text-decoration: none !important; }
    .link { text-decoration: none !important; border-bottom: 0 !important; }

    /* Reset / Base */
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;background:#fff;min-height:100vh;display:flex;flex-direction:column;color:#333}

    /* =================== NAVBAR 스타일 - 최우선 적용 =================== */
    .navbar{
      background: var(--navbar-bg) !important;
      border-bottom: 1px solid var(--navbar-border) !important;
      height: var(--navbar-height) !important;
      flex-shrink: 0 !important;
      min-height: var(--navbar-height) !important;
      max-height: var(--navbar-height) !important;
      position: relative !important;
      z-index: 1000 !important;
    }
    
    .nav-row{
      max-width: 1200px !important;
      margin: 0 auto !important;
      display: flex !important;
      align-items: center !important;
      justify-content: space-between !important;
      gap: 12px !important;
      padding: 12px 24px !important;
      height: 100% !important;
      min-height: 48px !important;
      box-sizing: border-box !important;
    }
    
    .brand{
      display: flex !important;
      align-items: center !important;
      gap: 8px !important;
      text-decoration: none !important;
      color: var(--navbar-text) !important;
      font-weight: 700 !important;
      font-size: 1.25rem !important;
      height: 48px !important;
      flex-shrink: 0 !important;
    }
    .brand:hover{color: var(--navbar-primary) !important;}
    .brand img{width: 45px !important; height: 45px !important; flex-shrink: 0 !important;}

    /* Buttons / Links - navbar 전용 스타일 */
    .navbar .btn{
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
      padding: .75rem 1.25rem !important;
      border-radius: .5rem !important;
      transition: all .25s ease !important;
      text-decoration: none !important;
      border: none !important;
      cursor: pointer !important;
      font: 500 .95rem/1 inherit !important;
      min-height: 40px !important;
      white-space: nowrap !important;
      min-width: 80px !important;
      box-sizing: border-box !important;
    }
    .navbar .btn.primary{
      background: var(--navbar-primary) !important;
      color: #fff !important;
    }
    .navbar .btn.primary:hover{
      background: var(--navbar-primary-hover) !important;
      transform: translateY(-1px) !important;
      box-shadow: 0 4px 12px rgba(99,102,241,.3) !important;
      color: #fff !important;
    }
    .navbar .btn.danger{
      background: var(--navbar-danger) !important;
      color: #fff !important;
    }
    .navbar .btn.danger:hover{
      background: var(--navbar-danger-hover) !important;
      transform: translateY(-1px) !important;
      box-shadow: 0 4px 12px rgba(239,68,68,.3) !important;
      color: #fff !important;
    }
    
    .navbar .link{
      color: var(--navbar-text-muted) !important;
      padding: .75rem 1rem !important;
      border-radius: .5rem !important;
      display: inline-flex !important;
      align-items: center !important;
      justify-content: center !important;
      min-height: 40px !important;
      white-space: nowrap !important;
      text-decoration: none !important;
      transition: all .25s ease !important;
      box-sizing: border-box !important;
    }
    .navbar .link:hover{
      background: var(--navbar-hover-bg) !important;
      color: var(--navbar-text-active) !important;
    }
    .navbar .active{
      background: var(--navbar-hover-bg) !important;
      color: var(--navbar-text-active) !important;
      font-weight: 700 !important;
    }

    /* Profile chip - navbar 전용 */
    .navbar .profile{
      display: flex !important;
      align-items: center !important;
      gap: .5rem !important;
      text-decoration: none !important;
      color: inherit !important;
      padding: .75rem 1rem !important;
      border-radius: .5rem !important;
      min-height: 40px !important;
      white-space: nowrap !important;
      transition: all .25s ease !important;
      box-sizing: border-box !important;
    }
    .navbar .profile:hover{background: var(--navbar-hover-bg) !important;}
    .navbar .avatar{
      width: 32px !important;
      height: 32px !important;
      border-radius: 50% !important;
      overflow: hidden !important;
      border: 2px solid var(--navbar-border) !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      background: var(--navbar-hover-bg) !important;
      flex-shrink: 0 !important;
    }
    .navbar .avatar img{width: 32px !important; height: 32px !important; object-fit: cover !important; border-radius: 50% !important;}

    /* Desktop menu - navbar 전용 */
    .navbar .menu{
      display: flex !important;
      align-items: center !important;
      gap: 8px !important;
      height: 48px !important;
    }
    .navbar .menu-divider{display: none !important;}

    /* Hamburger button - navbar 전용 */
    .navbar .hamburger{
      display: none !important;
      width: 48px !important;
      height: 48px !important;
      border: 1px solid var(--navbar-border) !important;
      border-radius: .5rem !important;
      background: var(--navbar-bg) !important;
      align-items: center !important;
      justify-content: center !important;
      flex-shrink: 0 !important;
      transition: all .25s ease !important;
    }
    .navbar .hamburger svg{width: 22px !important; height: 22px !important;}
    .navbar .hamburger[aria-expanded="true"]{background: var(--navbar-hover-bg) !important;}

    /* Form 버튼 크기 일관성 - navbar 전용 */
    .navbar .menu form {
      display: inline-block !important;
      margin: 0 !important;
    }
    .navbar .menu form .btn {
      margin: 0 !important;
    }

    /* Mobile navbar 스타일 */
    @media (max-width:900px){
      .navbar .nav-row{
        align-items: center !important;
        height: var(--navbar-height) !important;
        min-height: var(--navbar-height) !important;
        max-height: var(--navbar-height) !important;
      }
      .navbar .hamburger{display: flex !important;}
      .navbar .menu{
        position: absolute !important; 
        left: 0 !important; 
        right: 0 !important; 
        top: var(--navbar-height) !important;
        background: var(--navbar-bg) !important; 
        border-bottom: 1px solid var(--navbar-border) !important;
        display: none !important; 
        flex-direction: column !important; 
        gap: 8px !important; 
        padding: 1rem !important;
        z-index: 1000 !important;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1) !important;
        width: 100% !important;
        box-sizing: border-box !important;
      }
      .navbar .menu.open{display: flex !important;}
      .navbar .menu .link,
      .navbar .menu .profile,
      .navbar .menu form .btn{
        width: 100% !important;
        text-align: center !important;
        justify-content: center !important;
        height: 44px !important;
        min-height: 44px !important;
        max-height: 44px !important;
        margin-bottom: 4px !important;
        box-sizing: border-box !important;
      }
      .navbar .menu form{
        width: 100% !important;
        margin: 0 !important;
      }
      .navbar .menu-divider{
        display: block !important;
        margin: .75rem 0 !important;
        border-top: 1px dashed var(--navbar-border) !important;
        width: 100% !important;
        height: 1px !important;
        border-bottom: none !important;
        border-left: none !important;
        border-right: none !important;
      }
    }
    /* =================== NAVBAR 스타일 끝 =================== */

    /* 일반 페이지용 컴포넌트들 (navbar에 영향받지 않도록) */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .container{
      flex: 1;
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
      width: 100%;
    }

    .chat-page {
      flex: 1;
      display: flex;
      flex-direction: column;
      height: calc(100vh - var(--navbar-height));
      margin: 0;
      padding: 0;
      max-width: none;
      width: 100%;
    }

    /* 일반 버튼들 (navbar 밖에서 사용) */
    .btn{
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: .75rem 1.25rem;
      border-radius: .5rem;
      transition: all .25s ease;
      text-decoration: none;
      border: none;
      cursor: pointer;
      font: 500 .95rem/1 inherit;
      min-height: 40px;
      white-space: nowrap;
      min-width: 80px;
      box-sizing: border-box;
    }
    .btn.primary{background: #6366f1; color: #fff;}
    .btn.primary:hover{background: #4f46e5; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(99,102,241,.3);}
    .btn.danger{background: #ef4444; color: #fff;}
    .btn.danger:hover{background: #dc2626; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(239,68,68,.3);}

    .link{
      color: #6b7280;
      padding: .75rem 1rem;
      border-radius: .5rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-height: 40px;
      white-space: nowrap;
      text-decoration: none;
      transition: all .25s ease;
      box-sizing: border-box;
    }
    .link:hover{background: #f3f4f6; color: #374151;}

    /* Messages */
    .messages{margin-bottom: 1rem;}
    .alert{padding: 1rem 1.2rem; border-radius: .75rem; margin-bottom: 1rem; font-weight: 500; border-left: 4px solid;}
    .alert-success{background: #f0fdf4; color: #166534; border-color: #22c55e;}
    .alert-info{background: #eff6ff; color: #1e40af; border-color: #3b82f6;}
    .alert-warning{background: #fffbeb; color: #92400e; border-color: #f59e0b;}
    .alert-error{background: #fef2f2; color: #991b1b; border-color: #ef4444;}

    /* Home card */
    .welcome-card{background: #fff; border: 1px solid #f3f4f6; border-radius: 1rem; padding: 3rem; box-shadow: 0 1px 3px rgba(0,0,0,.1),0 1px 2px rgba(0,0,0,.06); text-align: center;}
    .welcome-card h1{color: #111827; font-size: 2.5rem; margin-bottom: 1rem; font-weight: 700;}
    .welcome-card p{color: #6b7280; font-size: 1.1rem; line-height: 1.6;}
  </style>
  {% block extra_head %}{% endblock %}
</head>
<body>
  <nav class="navbar">
    <div class="nav-row">
      <!-- Brand -->
      <a href="/" class="brand">
        <img src="{% static 'images/profiles/default_2.png' %}" alt="Hungry Jackie Logo"/>
        Hungry Jackie
      </a>

      <!-- Right: desktop menu + mobile hamburger -->
      <div style="display:flex;align-items:center;gap:8px">
        <!-- Desktop menu (also used as mobile dropdown container) -->
        <div class="menu" id="navMenu">
          {% with path=request.path %}
            {% url 'characters:character_list' as list_url %}
            {% url 'characters:character_create' as create_url %}
            {% url 'characters:my_characters' as my_url %}

            <!-- Characters -->
            <a href="{{ list_url }}"
               class="link {% if path|slice:':12' == '/characters/' and path != create_url and path != my_url and not 'chat/' in path %}active{% endif %}">
              캐릭터 탐색
            </a>

            {% if user.is_authenticated %}
              <a href="{{ create_url }}" class="link {% if path == create_url %}active{% endif %}">캐릭터 만들기</a>
              <a href="{{ my_url }}" class="link {% if path == my_url %}active{% endif %}">내 캐릭터</a>
            {% endif %}

            <hr class="menu-divider"/>

            <!-- Profile / Login -->
            {% if user.is_authenticated %}
              <a href="{% url 'profiles:profile' %}" class="profile">
                {% if user.profile.is_profile_complete %}
                  <span class="avatar">
                    <img src="{% static 'images/profiles/' %}{{ user.profile.profile_image }}"
                         alt="{{ user.profile.get_profile_image_display }}"
                         onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=&quot;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:50%;background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;font-size:14px;font-weight:700;&quot;>{{ user.profile.display_name|first|upper }}</span>';">
                  </span>
                  <span>{{ user.profile.display_name }}님</span>
                {% else %}
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#6366f1" style="margin-right:.25rem">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
                  <span>{{ user.email }}님</span>
                {% endif %}
              </a>
              <form method="post" action="{% url 'account_logout' %}">
                {% csrf_token %}
                <button type="submit" class="btn danger">로그아웃</button>
              </form>
            {% else %}
              <a href="{% url 'account_login' %}" class="btn primary">로그인</a>
            {% endif %}
          {% endwith %}
        </div>

        <!-- Hamburger (mobile) -->
        <button class="hamburger" id="hb" aria-label="메뉴" aria-controls="navMenu" aria-expanded="false">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>
    </div>
  </nav>

  <div class="main-content">
    {% block content %}{% endblock %}
  </div>

  {% block extra_body %}{% endblock %}

  <script>
    (function(){
      const hb = document.getElementById('hb');
      const menu = document.getElementById('navMenu');
      if(!hb || !menu) return;

      // 초기 상태: 데스크톱에서는 항상 보이도록, 모바일에서는 닫힌 상태
      function syncByWidth(){
        if(window.innerWidth > 900){
          menu.classList.remove('open');
          menu.style.display = 'flex';
          hb.setAttribute('aria-expanded','false');
        }else{
          menu.classList.remove('open');
          menu.style.display = '';
          hb.setAttribute('aria-expanded','false');
        }
      }
      window.addEventListener('resize', syncByWidth);
      syncByWidth();

      hb.addEventListener('click', function(){
        const expanded = hb.getAttribute('aria-expanded') === 'true';
        hb.setAttribute('aria-expanded', String(!expanded));
        menu.classList.toggle('open');
      });
    })();
  </script>
</body>
</html>