<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{% block title %}Hungry Jackie{% endblock %}</title>
  {% load static %}
  <style>

    /* 링크 밑줄 전역 제거 */
    a, a:visited { text-decoration: none !important; }
    a:hover, a:focus, a:active { text-decoration: none !important; }
    .link { text-decoration: none !important; border-bottom: 0 !important; }

    /* Reset / Base */
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;background:#fff;min-height:100vh;display:flex;flex-direction:column;color:#333}

    /* Navbar - 고정 높이 설정 */
    .navbar{
      background:#fff;
      border-bottom:1px solid #e5e7eb;
      height: 72px; /* 고정 높이 */
      flex-shrink: 0; /* 축소되지 않도록 */
      min-height: 72px; /* 최소 높이 보장 */
    }
    .nav-row{
      max-width:1200px;
      margin:0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px 24px;
      height: 100%; /* navbar 전체 높이 사용 */
      min-height: 48px; /* 내부 컨텐츠 최소 높이 */
    }
    .brand{
      display:flex;
      align-items:center;
      gap:8px;
      text-decoration:none;
      color:#111827;
      font-weight:700;
      font-size:1.25rem;
      height: 48px; /* 고정 높이 */
      flex-shrink: 0;
    }
    .brand:hover{color:#6366f1}
    .brand img{width:45px;height:45px;flex-shrink:0}

    /* Buttons / Links - 고정 크기 설정 */
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:.75rem 1.25rem;
      border-radius:.5rem;
      transition:all .25s ease;
      text-decoration:none;
      border:none;
      cursor:pointer;
      font:500 .95rem/1 inherit;
      min-height: 40px; /* 최소 높이 고정 */
      white-space: nowrap; /* 텍스트 줄바꿈 방지 */
      min-width: 80px; /* 최소 너비 설정 */
      box-sizing: border-box;
    }
    .btn.primary{background:#6366f1;color:#fff}
    .btn.primary:hover{background:#4f46e5;transform:translateY(-1px);box-shadow:0 4px 12px rgba(99,102,241,.3)}
    .btn.danger{background:#ef4444;color:#fff}
    .btn.danger:hover{background:#dc2626;transform:translateY(-1px);box-shadow:0 4px 12px rgba(239,68,68,.3)}
    .link{
      color:#6b7280;
      padding:.75rem 1rem;
      border-radius:.5rem;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-height: 40px;
      white-space: nowrap;
      text-decoration:none;
      transition:all .25s ease;
      box-sizing: border-box;
    }
    .link:hover{background:#f3f4f6;color:#374151}
    .active{background:#f3f4f6;color:#374151!important;font-weight:700}

    /* Profile chip - 고정 크기 설정 */
    .profile{
      display:flex;
      align-items:center;
      gap:.5rem;
      text-decoration:none;
      color:inherit;
      padding:.75rem 1rem;
      border-radius:.5rem;
      min-height: 40px;
      white-space: nowrap;
      transition:all .25s ease;
      box-sizing: border-box;
    }
    .profile:hover{background:#f3f4f6}
    .avatar{
      width:32px;
      height:32px;
      border-radius:50%;
      overflow:hidden;
      border:2px solid #e5e7eb;
      display:flex;
      align-items:center;
      justify-content:center;
      background:#f3f4f6;
      flex-shrink: 0;
    }
    .avatar img{width:32px;height:32px;object-fit:cover;border-radius:50%}

    /* Desktop menu (default) - 정렬 개선 */
    .menu{
      display:flex;
      align-items:center;
      gap:8px;
      height: 48px; /* 고정 높이 */
    }
    .menu-divider{display:none}

    /* Hamburger button (mobile only) - 고정 크기 */
    .hamburger{
      display:none;
      width:48px;
      height:48px;
      border:1px solid #e5e7eb;
      border-radius:.5rem;
      background:#fff;
      align-items:center;
      justify-content:center;
      flex-shrink: 0;
      transition:all .25s ease;
    }
    .hamburger svg{width:22px;height:22px}
    .hamburger[aria-expanded="true"]{background:#f3f4f6}

    /* Form 버튼 크기 일관성 */
    .menu form {
      display: inline-block;
      margin: 0;
    }
    .menu form .btn {
      margin: 0;
    }

    /* Container 설정 */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    /* 일반 페이지용 컨테이너 */
    .container{
      flex:1;
      max-width:1200px;
      margin:2rem auto;
      padding:0 1rem;
      width:100%;
    }

    /* 채팅 페이지용 컨테이너 */
    .chat-page {
      flex: 1;
      display: flex;
      flex-direction: column;
      height: calc(100vh - 72px); /* navbar 높이 제외 */
      margin: 0;
      padding: 0;
      max-width: none;
      width: 100%;
    }

    /* Messages */
    .messages{margin-bottom:1rem}
    .alert{padding:1rem 1.2rem;border-radius:.75rem;margin-bottom:1rem;font-weight:500;border-left:4px solid}
    .alert-success{background:#f0fdf4;color:#166534;border-color:#22c55e}
    .alert-info{background:#eff6ff;color:#1e40af;border-color:#3b82f6}
    .alert-warning{background:#fffbeb;color:#92400e;border-color:#f59e0b}
    .alert-error{background:#fef2f2;color:#991b1b;border-color:#ef4444}

    /* Home card */
    .welcome-card{background:#fff;border:1px solid #f3f4f6;border-radius:1rem;padding:3rem;box-shadow:0 1px 3px rgba(0,0,0,.1),0 1px 2px rgba(0,0,0,.06);text-align:center}
    .welcome-card h1{color:#111827;font-size:2.5rem;margin-bottom:1rem;font-weight:700}
    .welcome-card p{color:#6b7280;font-size:1.1rem;line-height:1.6}

    /* Mobile (<=900px): use hamburger - 완전 크기 일관성 개선 */
    @media (max-width:900px){
      .nav-row{
        align-items:center !important;
        height: 72px !important;
        min-height: 72px !important;
        max-height: 72px !important;
      }
      .hamburger{display:flex !important}
      .menu{ /* start hidden under navbar */
        position:absolute !important; 
        left:0 !important; 
        right:0 !important; 
        top:72px !important; /* navbar 높이에 맞춤 */
        background:#fff !important; 
        border-bottom:1px solid #e5e7eb !important;
        display:none !important; 
        flex-direction:column !important; 
        gap:8px !important; 
        padding:1rem !important;
        z-index: 1000 !important; /* 다른 요소 위에 표시 */
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1) !important;
        width: 100% !important;
        box-sizing: border-box !important;
      }
      .menu.open{display:flex !important}
      .menu .link,
      .menu .profile,
      .menu form .btn{
        width:100% !important;
        text-align:center !important;
        justify-content:center !important;
        height: 44px !important; /* 모바일에서 터치하기 쉬운 크기 */
        min-height: 44px !important;
        max-height: 44px !important;
        margin-bottom: 4px !important;
        box-sizing: border-box !important;
      }
      .menu form{
        width: 100% !important;
        margin: 0 !important;
      }
      .menu-divider{
        display:block !important;
        margin:.75rem 0 !important;
        border-top:1px dashed #e5e7eb !important;
        width: 100% !important;
        height: 1px !important;
        border-bottom: none !important;
        border-left: none !important;
        border-right: none !important;
      }
    }
  </style>
  {% block extra_head %}{% endblock %}
</head>
<body>
  <nav class="navbar">
    <div class="nav-row">
      <!-- Brand -->
      <a href="/" class="brand">
        <img src="{% static 'images/profiles/default_2.png' %}" alt="Hungry Jackie Logo"/>
        Hungry Jackie
      </a>

      <!-- Right: desktop menu + mobile hamburger -->
      <div style="display:flex;align-items:center;gap:8px">
        <!-- Desktop menu (also used as mobile dropdown container) -->
        <div class="menu" id="navMenu">
          {% with path=request.path %}
            {% url 'characters:character_list' as list_url %}
            {% url 'characters:character_create' as create_url %}
            {% url 'characters:my_characters' as my_url %}

            <!-- Characters -->
            <a href="{{ list_url }}"
               class="link {% if path|slice:':12' == '/characters/' and path != create_url and path != my_url and not 'chat/' in path %}active{% endif %}">
              캐릭터 탐색
            </a>

            {% if user.is_authenticated %}
              <a href="{{ create_url }}" class="link {% if path == create_url %}active{% endif %}">캐릭터 만들기</a>
              <a href="{{ my_url }}" class="link {% if path == my_url %}active{% endif %}">내 캐릭터</a>
            {% endif %}

            <hr class="menu-divider"/>

            <!-- Profile / Login -->
            {% if user.is_authenticated %}
              <a href="{% url 'profiles:profile' %}" class="profile">
                {% if user.profile.is_profile_complete %}
                  <span class="avatar">
                    <img src="{% static 'images/profiles/' %}{{ user.profile.profile_image }}"
                         alt="{{ user.profile.get_profile_image_display }}"
                         onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=&quot;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:50%;background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;font-size:14px;font-weight:700;&quot;>{{ user.profile.display_name|first|upper }}</span>';">
                  </span>
                  <span>{{ user.profile.display_name }}님</span>
                {% else %}
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#6366f1" style="margin-right:.25rem">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
                  <span>{{ user.email }}님</span>
                {% endif %}
              </a>
              <form method="post" action="{% url 'account_logout' %}">
                {% csrf_token %}
                <button type="submit" class="btn danger">로그아웃</button>
              </form>
            {% else %}
              <a href="{% url 'account_login' %}" class="btn primary">로그인</a>
            {% endif %}
          {% endwith %}
        </div>

        <!-- Hamburger (mobile) -->
        <button class="hamburger" id="hb" aria-label="메뉴" aria-controls="navMenu" aria-expanded="false">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>
    </div>
  </nav>

  <div class="main-content">
    {% block content %}{% endblock %}
  </div>

  {% block extra_body %}{% endblock %}

  <script>
    (function(){
      const hb = document.getElementById('hb');
      const menu = document.getElementById('navMenu');
      if(!hb || !menu) return;

      // 초기 상태: 데스크톱에서는 항상 보이도록, 모바일에서는 닫힘
      function syncByWidth(){
        if(window.innerWidth > 900){
          menu.classList.remove('open'); // 데스크톱에서는 open 클래스 필요 없음(기본 flex)
          // 데스크톱 레이아웃에서는 .menu가 기본적으로 flex로 보임
          menu.style.display = 'flex';
          hb.setAttribute('aria-expanded','false');
        }else{
          // 모바일 기본: 닫힌 상태
          menu.classList.remove('open');
          menu.style.display = ''; // CSS에서 제어(display:none)
          hb.setAttribute('aria-expanded','false');
        }
      }
      window.addEventListener('resize', syncByWidth);
      syncByWidth();

      hb.addEventListener('click', function(){
        const expanded = hb.getAttribute('aria-expanded') === 'true';
        hb.setAttribute('aria-expanded', String(!expanded));
        menu.classList.toggle('open');
      });
    })();
  </script>
</body>
</html>