<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{% block title %}Hungry Jackie{% endblock %}</title>
  {% load static %}
  <style>

    /* 링크 밑줄 전역 제거 */
    a, a:visited { text-decoration: none !important; }
    a:hover, a:focus, a:active { text-decoration: none !important; }
    .link { text-decoration: none !important; border-bottom: 0 !important; }

    /* Reset / Base */
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;background:#fff;min-height:100vh;display:flex;flex-direction:column;color:#333}

    /* Navbar */
    .navbar{background:#fff;border-bottom:1px solid #e5e7eb}
    .nav-row{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 24px}
    .brand{display:flex;align-items:center;gap:8px;text-decoration:none;color:#111827;font-weight:700;font-size:1.25rem}
    .brand:hover{color:#6366f1}
    .brand img{width:45px;height:45px}

    /* Buttons / Links */
    .btn{display:inline-block;padding:.5rem 1rem;border-radius:.5rem;transition:all .25s ease;text-decoration:none;border:none;cursor:pointer;font:500 .95rem/1 inherit}
    .btn.primary{background:#6366f1;color:#fff}
    .btn.primary:hover{background:#4f46e5;transform:translateY(-1px);box-shadow:0 4px 12px rgba(99,102,241,.3)}
    .btn.danger{background:#ef4444;color:#fff}
    .btn.danger:hover{background:#dc2626;transform:translateY(-1px);box-shadow:0 4px 12px rgba(239,68,68,.3)}
    .link{color:#6b7280;padding:.5rem 1rem;border-radius:.5rem}
    .link:hover{background:#f3f4f6;color:#374151}
    .active{background:#f3f4f6;color:#374151!important;font-weight:700}

    /* Profile chip */
    .profile{display:flex;align-items:center;gap:.5rem;text-decoration:none;color:inherit;padding:.5rem 1rem;border-radius:.5rem}
    .profile:hover{background:#f3f4f6}
    .avatar{width:32px;height:32px;border-radius:50%;overflow:hidden;border:2px solid #e5e7eb;display:flex;align-items:center;justify-content:center;background:#f3f4f6}
    .avatar img{width:32px;height:32px;object-fit:cover;border-radius:50%}

    /* Desktop menu (default) */
    .menu{display:flex;align-items:center;gap:6px}
    .menu-divider{display:none}

    /* Hamburger button (mobile only) */
    .hamburger{display:none;width:40px;height:40px;border:1px solid #e5e7eb;border-radius:.5rem;background:#fff;align-items:center;justify-content:center}
    .hamburger svg{width:22px;height:22px}
    .hamburger[aria-expanded="true"]{background:#f3f4f6}

    /* Container */
    .container{flex:1;max-width:1200px;margin:2rem auto;padding:0 1rem;width:100%}

    /* Messages */
    .messages{margin-bottom:1rem}
    .alert{padding:1rem 1.2rem;border-radius:.75rem;margin-bottom:1rem;font-weight:500;border-left:4px solid}
    .alert-success{background:#f0fdf4;color:#166534;border-color:#22c55e}
    .alert-info{background:#eff6ff;color:#1e40af;border-color:#3b82f6}
    .alert-warning{background:#fffbeb;color:#92400e;border-color:#f59e0b}
    .alert-error{background:#fef2f2;color:#991b1b;border-color:#ef4444}

    /* Home card */
    .welcome-card{background:#fff;border:1px solid #f3f4f6;border-radius:1rem;padding:3rem;box-shadow:0 1px 3px rgba(0,0,0,.1),0 1px 2px rgba(0,0,0,.06);text-align:center}
    .welcome-card h1{color:#111827;font-size:2.5rem;margin-bottom:1rem;font-weight:700}
    .welcome-card p{color:#6b7280;font-size:1.1rem;line-height:1.6}

    /* Mobile (<=900px): use hamburger */
    @media (max-width:900px){
      .nav-row{align-items:center}
      .hamburger{display:flex}
      .menu{ /* start hidden under navbar */
        position:absolute; left:0; right:0; top:64px;
        background:#fff; border-bottom:1px solid #e5e7eb;
        display:none; flex-direction:column; gap:0; padding:.5rem 1rem 1rem;
      }
      .menu.open{display:flex}
      .menu .link,.menu .profile,.menu form .btn{width:100%;text-align:left}
      .menu-divider{display:block;margin:.5rem 0;border-top:1px dashed #e5e7eb}
    }
  </style>
  {% block extra_head %}{% endblock %}
</head>
<body>
  <nav class="navbar">
    <div class="nav-row">
      <!-- Brand -->
      <a href="/" class="brand">
        <img src="{% static 'images/profiles/default_2.png' %}" alt="Hungry Jackie Logo"/>
        Hungry Jackie
      </a>

      <!-- Right: desktop menu + mobile hamburger -->
      <div style="display:flex;align-items:center;gap:8px">
        <!-- Desktop menu (also used as mobile dropdown container) -->
        <div class="menu" id="navMenu">
          {% with path=request.path %}
            {% url 'characters:character_list' as list_url %}
            {% url 'characters:character_create' as create_url %}
            {% url 'characters:my_characters' as my_url %}

            <!-- Characters -->
            <a href="{{ list_url }}"
               class="link {% if path|slice:':12' == '/characters/' and path != create_url and path != my_url and not 'chat/' in path %}active{% endif %}">
              캐릭터 탐색
            </a>

            {% if user.is_authenticated %}
              <a href="{{ create_url }}" class="link {% if path == create_url %}active{% endif %}">캐릭터 만들기</a>
              <a href="{{ my_url }}" class="link {% if path == my_url %}active{% endif %}">내 캐릭터</a>
            {% endif %}

            <hr class="menu-divider"/>

            <!-- Profile / Login -->
            {% if user.is_authenticated %}
              <a href="{% url 'profiles:profile' %}" class="profile">
                {% if user.profile.is_profile_complete %}
                  <span class="avatar">
                    <img src="{% static 'images/profiles/' %}{{ user.profile.profile_image }}"
                         alt="{{ user.profile.get_profile_image_display }}"
                         onerror="this.style.display='none'; this.parentElement.innerHTML='<span style=&quot;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:50%;background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;font-size:14px;font-weight:700;&quot;>{{ user.profile.display_name|first|upper }}</span>';">
                  </span>
                  <span>{{ user.profile.display_name }}님</span>
                {% else %}
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#6366f1" style="margin-right:.25rem">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
                  <span>{{ user.email }}님</span>
                {% endif %}
              </a>
              <form method="post" action="{% url 'account_logout' %}">
                {% csrf_token %}
                <button type="submit" class="btn danger" style="width:100%">로그아웃</button>
              </form>
            {% else %}
              <a href="{% url 'account_login' %}" class="btn primary" style="text-align:center">로그인</a>
            {% endif %}
          {% endwith %}
        </div>

        <!-- Hamburger (mobile) -->
        <button class="hamburger" id="hb" aria-label="메뉴" aria-controls="navMenu" aria-expanded="false">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>
    </div>
  </nav>

  <div class="container">
    {% if messages %}
      <div class="messages">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}

    {% block content %}{% endblock %}
  </div>

  {% block extra_body %}{% endblock %}

  <script>
    (function(){
      const hb = document.getElementById('hb');
      const menu = document.getElementById('navMenu');
      if(!hb || !menu) return;

      // 초기 상태: 데스크톱에서는 항상 보이도록, 모바일에서는 닫힘
      function syncByWidth(){
        if(window.innerWidth > 900){
          menu.classList.remove('open'); // 데스크톱에서는 open 클래스 필요 없음(기본 flex)
          // 데스크톱 레이아웃에서는 .menu가 기본적으로 flex로 보임
          menu.style.display = 'flex';
          hb.setAttribute('aria-expanded','false');
        }else{
          // 모바일 기본: 닫힌 상태
          menu.classList.remove('open');
          menu.style.display = ''; // CSS에서 제어(display:none)
          hb.setAttribute('aria-expanded','false');
        }
      }
      window.addEventListener('resize', syncByWidth);
      syncByWidth();

      hb.addEventListener('click', function(){
        const expanded = hb.getAttribute('aria-expanded') === 'true';
        hb.setAttribute('aria-expanded', String(!expanded));
        menu.classList.toggle('open');
      });
    })();
  </script>
</body>
</html>
