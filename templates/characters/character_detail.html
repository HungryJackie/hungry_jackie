{% extends "base.html" %}
{% load static %}
{% block title %}{{ character.name }} - Hungry Jackie{% endblock %}

{% block content %}
<div class="container">
    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}

    <div style="display:grid; grid-template-columns: 1fr; gap:1rem; max-width:900px;">
        <div style="border:1px solid #e5e7eb; border-radius:.75rem; padding:2rem; background:#fff; box-shadow: 0 1px 3px rgba(0,0,0,.1);">
            
            {# 캐릭터 기본 정보 헤더 #}
            <div style="display: flex; align-items: flex-start; gap: 1.5rem; margin-bottom: 1.5rem;">
                {# 캐릭터 이미지 #}
                <div style="flex-shrink: 0;">
                    {% if character.character_image %}
                        <img src="{{ character.character_image.url }}" alt="{{ character.name }}"
                             style="width:120px;height:120px;object-fit:cover;border-radius:12px;border:2px solid #e5e7eb;">
                    {% else %}
                        <div style="width:120px;height:120px;border-radius:12px;background:#f3f4f6;display:flex;align-items:center;justify-content:center;border:2px solid #e5e7eb;">
                            <span style="font-size:3rem;color:#9ca3af;">?</span>
                        </div>
                    {% endif %}
                </div>
                
                {# 캐릭터 정보 #}
                <div style="flex: 1;">
                    <h1 style="margin:0 0 .75rem 0; font-size:2rem; font-weight:700; color:#111827;">{{ character.name }}</h1>
                    
                    {# 메타 정보 #}
                    <div style="display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem; color:#6b7280; font-size:.95rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                            </svg>
                            <span>{{ character.genre.name }}</span>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                            </svg>
                            <span>평균 평점: {{ character.average_rating }} ({{ character.rating_count }}명)</span>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                            <span>by 
                                {% if character.creator.profile and character.creator.profile.display_name %}
                                    {{ character.creator.profile.display_name }}
                                {% else %}
                                    {{ character.creator.username }}
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    
                    {# 한줄 소개 #}
                    <p style="color:#374151; line-height:1.6; margin-bottom:1.5rem; font-size:1.1rem;">{{ character.description }}</p>
                    
                    {# 액션 버튼들 #}
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        {% if user.is_authenticated %}
                            {% if user_conversation %}
                                <a href="{% url 'characters:conversation' user_conversation.id %}" 
                                   style="display: inline-flex; align-items: center; gap: 0.5rem; padding:.75rem 1.5rem; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; text-decoration: none; border-radius: 0.5rem; font-weight: 600; transition: all 0.3s;"
                                   onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(99,102,241,.3)';"
                                   onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='none';">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                                    </svg>
                                    대화 계속하기
                                </a>
                            {% else %}
                                <a href="{% url 'characters:start_conversation' character.id %}" 
                                   style="display: inline-flex; align-items: center; gap: 0.5rem; padding:.75rem 1.5rem; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; text-decoration: none; border-radius: 0.5rem; font-weight: 600; transition: all 0.3s;"
                                   onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(99,102,241,.3)';"
                                   onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='none';">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                                    </svg>
                                    대화 시작
                                </a>
                            {% endif %}
                        {% else %}
                            <a href="{% url 'account_login' %}" 
                               style="display: inline-flex; align-items: center; gap: 0.5rem; padding:.75rem 1.5rem; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; text-decoration: none; border-radius: 0.5rem; font-weight: 600; transition: all 0.3s;"
                               onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(99,102,241,.3)';"
                               onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='none';">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
                                </svg>
                                로그인하고 대화 시작
                            </a>
                        {% endif %}
                        
                        <a href="{% url 'characters:character_list' %}" 
                           style="padding:.75rem 1.5rem; border:1px solid #d1d5db; color:#374151; text-decoration:none; border-radius:.5rem; font-weight:500; transition: all 0.3s;"
                           onmouseover="this.style.backgroundColor='#f3f4f6';"
                           onmouseout="this.style.backgroundColor='transparent';">
                            목록으로
                        </a>
                    </div>
                </div>
            </div>
            
            {# 구분선 #}
            <div style="height: 1px; background: #e5e7eb; margin: 2rem 0;"></div>
            
            {# 상세 정보 섹션 #}
            <div style="display: grid; gap: 1.5rem;">
                <details style="border: 1px solid #e5e7eb; border-radius: 0.5rem; overflow: hidden;">
                    <summary style="cursor:pointer; padding: 1rem; background: #f8fafc; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">
                        <svg style="display: inline-block; margin-right: 0.5rem; width: 16px; height: 16px;" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        성격 설정
                    </summary>
                    <div style="padding: 1.5rem; background: white;">
                        <pre style="white-space:pre-wrap; font-family: inherit; margin: 0; line-height: 1.6; color: #374151;">{{ character.personality }}</pre>
                    </div>
                </details>

                <details style="border: 1px solid #e5e7eb; border-radius: 0.5rem; overflow: hidden;">
                    <summary style="cursor:pointer; padding: 1rem; background: #f8fafc; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">
                        <svg style="display: inline-block; margin-right: 0.5rem; width: 16px; height: 16px;" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                        </svg>
                        배경 이야기
                    </summary>
                    <div style="padding: 1.5rem; background: white;">
                        <pre style="white-space:pre-wrap; font-family: inherit; margin: 0; line-height: 1.6; color: #374151;">{{ character.background_story }}</pre>
                    </div>
                </details>

                <details style="border: 1px solid #e5e7eb; border-radius: 0.5rem; overflow: hidden;">
                    <summary style="cursor:pointer; padding: 1rem; background: #f8fafc; font-weight: 600; color: #374151; border-bottom: 1px solid #e5e7eb;">
                        <svg style="display: inline-block; margin-right: 0.5rem; width: 16px; height: 16px;" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                        말투/대화 스타일
                    </summary>
                    <div style="padding: 1.5rem; background: white;">
                        <pre style="white-space:pre-wrap; font-family: inherit; margin: 0; line-height: 1.6; color: #374151;">{{ character.speaking_style }}</pre>
                    </div>
                </details>
                
                {# 태그 #}
                {% if character.get_tags_list %}
                    <div style="padding: 1rem; border: 1px solid #e5e7eb; border-radius: 0.5rem; background: #f8fafc;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#6b7280">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                            </svg>
                            <span style="font-weight: 600; color: #374151;">태그</span>
                        </div>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                            {% for tag in character.get_tags_list %}
                                <span style="display: inline-block; padding: 0.25rem 0.75rem; background: #e0e7ff; color: #3730a3; border-radius: 9999px; font-size: 0.85rem; font-weight: 500;">
                                    #{{ tag }}
                                </span>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}